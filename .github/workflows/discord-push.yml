name: Notify Discord with Style

on: [push]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send styled push info to Discord
        run: |
          REPO="${{ github.repository }}"
          USER="${{ github.actor }}"
          COMMIT_MSG="${{ github.event.head_commit.message }}"
          URL="${{ github.event.head_commit.url }}"

          ADDED=$(echo "${{ toJson(github.event.head_commit.added) }}" | jq -r '.[]' | sed ':a;N;$!ba;s/\n/\\n/g')
          MODIFIED=$(echo "${{ toJson(github.event.head_commit.modified) }}" | jq -r '.[]' | sed ':a;N;$!ba;s/\n/\\n/g')
          REMOVED=$(echo "${{ toJson(github.event.head_commit.removed) }}" | jq -r '.[]' | sed ':a;N;$!ba;s/\n/\\n/g')

          [ -z "$ADDED" ] && ADDED="âŒ None"
          [ -z "$MODIFIED" ] && MODIFIED="âŒ None"
          [ -z "$REMOVED" ] && REMOVED="âŒ None"

          PAYLOAD="{
            \"content\": null,
            \"embeds\": [
              {
                \"title\": \"ğŸš€ New Push in \`${REPO}\`\",
                \"description\": \"ğŸ‘¤ **User:** \`${USER}\`\\nğŸ“ **Message:**\n> ${COMMIT_MSG}\\nğŸ”— [View Commit](${URL})\",
                \"color\": 15844367,
                \"fields\": [
                  {\"name\": \"ğŸŸ©âœ¨ Added Files\", \"value\": \"\`\`\`\n${ADDED}\n\`\`\`\"},
                  {\"name\": \"ğŸŸ¨âš™ï¸ Modified Files\", \"value\": \"\`\`\`\n${MODIFIED}\n\`\`\`\"},
                  {\"name\": \"ğŸŸ¥ğŸ—‘ï¸ Removed Files\", \"value\": \"\`\`\`\n${REMOVED}\n\`\`\`\"}
                ],
                \"footer\": {
                  \"text\": \"XScripts Webhook by Maximum V5ğŸ”¥ğŸ—¿\"
                },
                \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
              }
            ]
          }"

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               https://discord.com/api/webhooks/1373491731068358797/dbZ0WxSAeVgNablRce4wbcpl3pYYADwJgSUf_i9A3Aea3_igUHXjPMso5FFvspTWh2mZ
